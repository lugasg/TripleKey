# TripleKey 页面模块说明

## 页面概述

TripleKey项目包含多个功能页面，每个页面都是一个独立的模块，通过统一的页面管理器进行管理。

## 页面列表

1. **时钟页面** (`clock`)
   - 显示当前时间
   - 支持多种时钟主题
   - 支持自动主题切换
   - 支持整点报时

2. **天气页面** (`weather`)
   - 显示天气信息
   - 支持天气预报

3. **股票页面** (`stocks`)
   - 显示股票信息

4. **米家页面** (`mijia`)
   - 米家设备控制

5. **照片页面** (`photo`)
   - 图片显示功能

6. **键盘页面** (`keyboard`)
   - 键盘控制功能

7. **快捷键页面** (`shortcut`)
   - 快捷键设置

8. **Web页面** (`web`)
   - Web相关功能

9. **媒体控制页面** (`media`)
   - 媒体播放控制

10. **哔哩哔哩页面** (`bilibili`)
    - B站相关功能

11. **倒计时页面** (`countdown`)
    - 倒计时功能

12. **番茄钟页面** (`pomodoro`)
    - 番茄工作法计时器

13. **设置页面** (`settings`)
    - 系统设置

## 页面管理

### 页面注册
所有页面都在 `pages.cpp` 中进行注册：
```cpp
page_t *pages[] = {
    &page_main,
    &page_clock,
    &page_weather,
    &page_stocks,
    &page_mijia,
    &page_photo,
    &page_keyboard,
    &page_shortcut,
    &page_web,
    &page_media,
    &page_bilibili,
    &page_countdown,
    &page_pomodoro,
    &page_settings,
};
```

### 页面切换
- 支持上下切换
- 支持直接跳转
- 支持返回主页

## 页面实现示例：时钟页面

### 功能特性
1. **多主题支持**
   - 支持多种时钟显示主题
   - 主题存储在文件系统中
   - 支持自动主题切换

2. **时间显示**
   - 显示小时、分钟、秒
   - 使用PNG图片显示数字
   - 支持局部更新以提高效率

3. **音频功能**
   - 支持整点报时
   - 可配置开关

### 实现细节

1. **初始化流程**
```cpp
void init(void *data) {
    // 扫描时钟主题
    // 初始化配置
    // 设置默认值
}
```

2. **显示更新**
```cpp
void dispTime(uint8_t hour, uint8_t min, uint8_t sec) {
    // 检查是否需要主题切换
    // 更新显示（仅更新变化的数字）
    // 处理特殊效果
}
```

3. **主循环处理**
```cpp
void loop(void *data) {
    // 获取当前时间
    // 处理按键事件
    // 更新显示
    // 处理音频
}
```

## 页面开发指南

### 1. 创建新页面
1. 在 `pages` 目录下创建新文件夹
2. 创建头文件和源文件
3. 实现必要的回调函数

### 2. 必要的回调函数
```cpp
void init(void *data)    // 初始化
void enter(void *data)   // 进入页面
void exit(void *data)    // 退出页面
void loop(void *data)    // 主循环
```

### 3. 页面注册
1. 在 `pages.cpp` 中包含页面头文件
2. 将页面添加到 `pages` 数组

### 4. 资源管理
- 在 `init` 中分配资源
- 在 `exit` 中释放资源
- 使用文件系统存储静态资源

### 5. 性能优化
- 使用局部更新而不是全屏刷新
- 缓存频繁使用的资源
- 避免在主循环中进行耗时操作

## 注意事项

1. **资源管理**
   - 正确处理内存分配和释放
   - 及时关闭打开的文件
   - 清理不再使用的资源

2. **显示优化**
   - 尽可能使用局部更新
   - 避免频繁刷新整个屏幕
   - 合理使用缓存机制

3. **交互响应**
   - 保持UI响应及时
   - 合理处理按键事件
   - 提供适当的用户反馈

4. **错误处理**
   - 检查资源加载是否成功
   - 处理异常情况
   - 提供用户友好的错误提示
